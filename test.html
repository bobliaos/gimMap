<html>
<head>
    <title>GimMap DEMO</title>
    <meta charset="utf-8">

    <script type="text/javascript" src="js/three.min.js"></script>
    <script type="text/javascript" src="js/stats.min.js"></script>
    <script type="text/javascript" src="js/tween.min.js"></script>

    <script type="text/javascript" src="js/gim/GIM.js"></script>
    <script type="text/javascript" src="js/gim/core/SVGParser.js"></script>
    <script type="text/javascript" src="js/gim/core/FloorData.js"></script>
    <script type="text/javascript" src="js/gim/core/astar/AStar.js"></script>
    <script type="text/javascript" src="js/gim/map3D/Map3D.js"></script>
    <script type="text/javascript" src="js/gim/map3D/DisplayFloor3D.js"></script>
</head>
<body style="padding: 0;margin: 0">
<script type="text/javascript">
    var mouseX = 0, mouseY = 0,

            windowHalfX = window.innerWidth / 2,
            windowHalfY = window.innerHeight / 2,

            camera, scene, renderer, material;
    init();
    animate();

    function init() {

        var i, container;

        container = document.createElement('div');
        document.body.appendChild(container);

        camera = new THREE.PerspectiveCamera(33, window.innerWidth / window.innerHeight, 1, 10000);
        camera.position.z = 700;

        scene = new THREE.Scene();

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        container.appendChild(renderer.domElement);

        var geometry = new THREE.Geometry();
        var points = [];
        for (var i = 0; i < 10; i++) {
            var point = new THREE.Vector3(Math.random() * 300 -150, Math.random() * 300 - 150, Math.random() * 300 - 150);
            points.push(point);
        }
        var spline = new THREE.Spline(points);
        var n_sub = 12;
        for (i = 0; i < points.length * n_sub; i++) {
            var index = i / ( points.length * n_sub );
            var position = spline.getPoint(index);
            geometry.vertices[ i ] = new THREE.Vector3(position.x, position.y, position.z);
        }

        material = new THREE.LineBasicMaterial({ color: 0xffffff});
        var line = new THREE.Line(geometry, material);
        scene.add(line);

        stats = new Stats();
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.top = '0px';
        container.appendChild(stats.domElement);

        document.addEventListener('mousemove', onDocumentMouseMove, false);
        document.addEventListener('touchstart', onDocumentTouchStart, false);
        document.addEventListener('touchmove', onDocumentTouchMove, false);

        window.addEventListener('resize', onWindowResize, false);
    }

    function onWindowResize() {
        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function onDocumentMouseMove(event) {
        mouseX = event.clientX - windowHalfX;
        mouseY = event.clientY - windowHalfY;
    }

    function onDocumentTouchStart(event) {

        if (event.touches.length > 1) {

            event.preventDefault();

            mouseX = event.touches[ 0 ].pageX - windowHalfX;
            mouseY = event.touches[ 0 ].pageY - windowHalfY;
        }
    }

    function onDocumentTouchMove(event) {

        if (event.touches.length == 1) {

            event.preventDefault();

            mouseX = event.touches[ 0 ].pageX - windowHalfX;
            mouseY = event.touches[ 0 ].pageY - windowHalfY;
        }

    }

    //

    function animate() {

        requestAnimationFrame(animate);
        render();
        stats.update();
    }

    function render() {

        camera.position.x += ( mouseX - camera.position.x ) * .05;
        camera.position.y += ( -mouseY + 200 - camera.position.y ) * .05;

        camera.lookAt(scene.position);

        var time = Date.now() * 0.0005;

        for (var i = 0; i < scene.children.length; i++) {

            var object = scene.children[ i ];

            if (object instanceof THREE.Line) {

                object.rotation.y = time * ( i % 2 ? 1 : -1 );

            }

        }

        renderer.render(scene, camera);

    }

</script>
</body>
</html>
